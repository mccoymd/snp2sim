paste0(path, "ribbon_by_variant.jpg"),
ggplot(plotdata, aes(ligand, group = variant, fill = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_ribbon(aes(ymin=relEnergy-std, ymax=relEnergy+std)) +
geom_line(aes(y = relEnergy)) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
facet_wrap(. ~ variant) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
), width = 20
)
ggsave(
paste0(path, "ribbon_by_ligand.jpg"),
ggplot(plotdata, aes(variant, group = ligand, fill = ligand)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_ribbon(aes(ymin=relEnergy-std, ymax=relEnergy+std)) +
geom_line(aes(y = relEnergy)) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
facet_wrap(. ~ ligand) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
), width = 20
)
distplotdata <- distdata[distdata$library == lib,]
ggsave(paste0(path, "violin.png"),
ggplot(distplotdata, aes(variant, trialRelEnergy, color = ligand)) +
theme_light() +
geom_violin() +
facet_wrap(.~ligand) +
theme(axis.text.x = element_text(angle = 90), legend.position = "none"),
width = 10, height = 6.5)
ggsave(paste0(path, "dot_box.png"),
ggplot(distplotdata, aes(variant, trialRelEnergy, color = ligand)) +
theme_light() +
geom_boxplot() +
geom_dotplot(binaxis='y',
stackdir='center',
dotsize = .5) +
facet_wrap(.~ligand) +
theme(axis.text.x = element_text(angle = 90), legend.position = "none"),
width = 10, height = 6.5)
ggsave(paste0(path, "box.png"),
ggplot(distplotdata, aes(variant, trialRelEnergy, color = ligand)) +
theme_light() +
geom_boxplot() +
facet_wrap(.~ligand) +
theme(axis.text.x = element_text(angle = 90), legend.position = "none"),
width = 10, height = 6.5)
}
minval <- min(fulldata$perChange)
maxval <- max(fulldata$perChange)
maxthresh <- max(c(abs(minval),  abs(maxval)))
h <- hchart(fulldata, "heatmap", hcaes(x = variant, y = ligand, value = perChange)) %>%
hc_colorAxis(stops = color_stops(4, inferno(4)), min = -1*maxthresh, max = maxthresh) %>%
hc_title(text = paste0("Binding energy of small molecules in ",unique(fulldata$protein)[1]," variants"))
htmlwidgets::saveWidget(h, paste0(path, "heatmap.html"), selfcontained = FALSE)
webshot(paste0(path, "heatmap.html"), file = paste0(path, "heatmap.png"), vwidth = 1000, vheight = 1000, zoom = 10)
}
ggsave(paste0(path, "dot.png"),
ggplot(distplotdata, aes(variant, trialRelEnergy, color = ligand)) +
theme_light() +
geom_dotplot(binaxis='y',
stackdir='center',
dotsize = .5) +
facet_wrap(.~ligand) +
theme(axis.text.x = element_text(angle = 90), legend.position = "none"),
width = 10, height = 6.5)
ggplot(distplotdata, aes(variant, trialRelEnergy, color = ligand)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_violin() +
facet_wrap(.~ligand) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90), legend.position = "none")
ggplot(distplotdata, aes(ligand, trialRelEnergy, color = ligand)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_violin() +
facet_wrap(.~ligand) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90), legend.position = "none")
ggplot(distplotdata, aes(ligand, trialRelEnergy, color = ligand)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_violin() +
facet_wrap(.~variant) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90), legend.position = "none")
ggplot(distplotdata, aes(ligand, trialRelEnergy, color = ligand)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
) +
geom_violin() +
facet_wrap(.~variant) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90), legend.position = "none")
#fulldata <- do.call(rbind, data)
#fulldata <- fulldata[fulldata$rank == 1,]
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
if(args[2] == "True"){
wtdata.mean <- aggregate(affinity ~ ligand, wtdata, mean)
wtdata <- aggregate(affinity ~ ligand, wtdata, sd)
wtdata <- merge(wtdata, wtdata.mean, by="ligand")
colnames(wtdata)[colnames(wtdata) == "affinity.x"] <-
"wtstd"
colnames(wtdata)[colnames(wtdata) == "affinity.y"] <-
"wtmeanAffinity"
fulldata <- merge(fulldata, wtdata, by = "ligand")
colnames(fulldata)[colnames(fulldata) == "affinity"] <-
"absAffinity"
colnames(fulldata)[colnames(fulldata) == "wtmeanAffinity"] <-
"wtAffinity"
#for distribution plots
fulldata$trialRelEnergy <- fulldata$absAffinity-fulldata$wtAffinity
distdata <- fulldata
error <- aggregate(absAffinity ~ ligand + variant, fulldata, sd)
colnames(error)[colnames(error) == "absAffinity"] <- "std"
fulldata <- merge(fulldata, error, by = c("ligand", "variant"))
meanval <- aggregate(absAffinity ~ ligand + variant, fulldata, mean)
colnames(meanval)[colnames(meanval) == "absAffinity"] <- "meanAffinity"
fulldata <- merge(fulldata, meanval,  by = c("ligand", "variant"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "meanAffinity")]),]
fulldata$relEnergy <- fulldata$meanAffinity-fulldata$wtAffinity
fulldata$varStd <- fulldata$std
fulldata$std <- fulldata$wtstd +fulldata$std
fulldata$perChange <- (fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
fulldata$perSD <- (fulldata$std / abs(fulldata$wtAffinity)) * 100
fulldata <- subset(fulldata, select = -c(rank, rmsd_ub, rmsd_lb, absAffinity, scaffold, trial))
} else {
wtdata <- aggregate(affinity ~ ligand, wtdata, min)
wtdata <- merge(wtdata, wtdata.mean, by="ligand")
fulldata <- merge(fulldata, wtdata, by = "ligand")
fulldata$relEnergy <- fulldata$affinity.x - fulldata$affinity.y
colnames(fulldata)[colnames(fulldata) == "affinity.x"] <-
"absAffinity"
colnames(fulldata)[colnames(fulldata) == "affinity.y"] <-
"wtAffinity"
fulldata$perChange <-
(fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
}
old_path <- path
for(lib in unique(fulldata$library)) {
plotdata <- fulldata[fulldata$library == lib,]
path <- paste0(old_path, lib, "/")
if(!dir.exists(path)) {
dir.create(path)
}
#ligand vs relative energy, split by variant
cur <- ggplot(plotdata, aes(ligand, relEnergy, fill = ligand, width = .5)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
facet_wrap(. ~ variant) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)
if(args[2] == "True"){
cur <- cur + geom_errorbar(aes(ymin=relEnergy-std, ymax=relEnergy+std), position = position_dodge())
}
ggsave(
paste0(path, "lig_relEnergy.jpg"),
cur, width = 20
)
#variant vs relative energy, split by ligand
cur <- ggplot(plotdata, aes(variant, relEnergy, fill = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
facet_wrap(. ~ ligand) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)
if(args[2] == "True"){
cur <- cur + geom_errorbar(aes(ymin=relEnergy-std, ymax=relEnergy+std), position = position_dodge())
}
ggsave(
paste0(path, "variant_relEnergy.jpg"),
cur, width = 20
)
#ligand vs percent change, split by variant
cur <- ggplot(plotdata, aes(ligand, perChange, fill = ligand)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Percent Change in Binding Energy (%)") +
theme(axis.text.x = element_text(angle = 90)) +
facet_wrap(. ~ variant) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)
if(args[2] == "True"){
cur <- cur + geom_errorbar(aes(ymin=perChange-perSD, ymax=perChange+perSD), position = position_dodge())
}
ggsave(
paste0(path, "lig_perChange.jpg"),
cur, width = 20
)
#variant vs percent change, split by ligand, colored by variant
cur <- ggplot(plotdata, aes(variant, perChange, fill = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Percent Change in Binding Energy (%)") +
theme(axis.text.x = element_blank()) +
facet_wrap(. ~ ligand) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)
if(args[2] == "True"){
cur <- cur + geom_errorbar(aes(ymin=perChange-perSD, ymax=perChange+perSD), position = position_dodge())
}
ggsave(
paste0(path, "variant_perChange.jpg"),
cur, width = 20, height = 40
)
if(args[2] == "True"){
ggsave(
paste0(path, "ribbon_by_variant.jpg"),
ggplot(plotdata, aes(ligand, group = variant, fill = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_ribbon(aes(ymin=relEnergy-std, ymax=relEnergy+std)) +
geom_line(aes(y = relEnergy)) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
facet_wrap(. ~ variant) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
), width = 20
)
ggsave(
paste0(path, "ribbon_by_ligand.jpg"),
ggplot(plotdata, aes(variant, group = ligand, fill = ligand)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_ribbon(aes(ymin=relEnergy-std, ymax=relEnergy+std)) +
geom_line(aes(y = relEnergy)) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
facet_wrap(. ~ ligand) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
), width = 20
)
distplotdata <- distdata[distdata$library == lib,]
ggsave(paste0(path, "lig_violin.png"),
ggplot(distplotdata, aes(variant, trialRelEnergy, color = ligand)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
) +
geom_violin() +
facet_wrap(.~ligand) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90), legend.position = "none"),
width = 10, height = 6.5)
ggsave(paste0(path, "lig_dot.png"),
ggplot(distplotdata, aes(variant, trialRelEnergy, color = ligand)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
) +
geom_dotplot(binaxis='y',
stackdir='center',
dotsize = .5) +
facet_wrap(.~ligand) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90), legend.position = "none"),
width = 10, height = 6.5)
ggsave(paste0(path, "lig_box.png"),
ggplot(distplotdata, aes(variant, trialRelEnergy, color = ligand)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
) +
geom_boxplot() +
facet_wrap(.~ligand) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90), legend.position = "none"),
width = 10, height = 6.5)
ggsave(paste0(path, "variant_violin.png"),
ggplot(distplotdata, aes(ligand, trialRelEnergy, color = ligand)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
) +
geom_violin() +
facet_wrap(.~variant) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90), legend.position = "none"),
width = 15, height = 10)
ggsave(paste0(path, "variant_dot.png"),
ggplot(distplotdata, aes(ligand, trialRelEnergy, color = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
) +
geom_dotplot(binaxis='y',
stackdir='center',
dotsize = .5) +
facet_wrap(.~variant) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90), legend.position = "none"),
width = 15, height = 10)
ggsave(paste0(path, "variant_box.png"),
ggplot(distplotdata, aes(ligand, trialRelEnergy, color = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
) +
geom_boxplot() +
facet_wrap(.~variant) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90), legend.position = "none"),
width = 15, height = 10)
}
minval <- min(fulldata$perChange)
maxval <- max(fulldata$perChange)
maxthresh <- max(c(abs(minval),  abs(maxval)))
h <- hchart(fulldata, "heatmap", hcaes(x = variant, y = ligand, value = perChange)) %>%
hc_colorAxis(stops = color_stops(4, inferno(4)), min = -1*maxthresh, max = maxthresh) %>%
hc_title(text = paste0("Binding energy of small molecules in ",unique(fulldata$protein)[1]," variants"))
htmlwidgets::saveWidget(h, paste0(path, "heatmap.html"), selfcontained = FALSE)
webshot(paste0(path, "heatmap.html"), file = paste0(path, "heatmap.png"), vwidth = 1000, vheight = 1000, zoom = 10)
}
path
library(reshape2)
library(stringr)
valid <- read.csv("variantValidationData.csv", header = TRUE)
for (col in colnames(valid)[3:ncol(valid)]){
valid[,col] <- (valid[,col] / valid$ref) * 100
}
for (col in colnames(valid)[3:ncol(valid)]){
colnames(valid)[colnames(valid) == col] <- str_replace(col, "X", "")
}
valid <- valid[,-9]
for (col in colnames(valid)[3:ncol(valid)]){
valid[,col] <- (valid[,col] / valid$wt) * 100
}
valid <- valid[,-3]
valid <- melt(valid, id.vars = c("experiment", "drug"), variable.name = "variant")
colnames(valid)[colnames(valid) == "drug"] <- "ligand"
library(ggplot2)
library(htmlwidgets)
library(highcharter)
library(viridis)
library(webshot)
table <- read.table("/Users/vikram/Documents/georgetown/summer_2019/opioid_receptor/mccoy_snp2sim_data/variantSimulations/OPRM1/results/analysis/153V_234P_235M_235N_238I_302I_wt/vinaSummary_OPRM1.txt", header = TRUE, sep = "")
pdbSet <- unique(table$scaffold)
ligSet <- unique(table$ligand)
varSet <- unique(table$variant)
data <- table
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
wtdata.mean <- aggregate(affinity ~ ligand, wtdata, mean)
wtdata <- aggregate(affinity ~ ligand, wtdata, sd)
wtdata <- merge(wtdata, wtdata.mean, by="ligand")
colnames(wtdata)[colnames(wtdata) == "affinity.x"] <-
"wtstd"
colnames(wtdata)[colnames(wtdata) == "affinity.y"] <-
"wtmeanAffinity"
fulldata <- merge(fulldata, wtdata, by = "ligand")
colnames(fulldata)[colnames(fulldata) == "affinity"] <-
"absAffinity"
colnames(fulldata)[colnames(fulldata) == "wtmeanAffinity"] <-
"wtAffinity"
error <- aggregate(absAffinity ~ ligand + variant, fulldata, sd)
colnames(error)[colnames(error) == "absAffinity"] <- "std"
fulldata <- merge(fulldata, error, by = c("ligand", "variant"))
meanval <- aggregate(absAffinity ~ ligand + variant, fulldata, mean)
colnames(meanval)[colnames(meanval) == "absAffinity"] <- "meanAffinity"
fulldata <- merge(fulldata, meanval,  by = c("ligand", "variant"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "meanAffinity")]),]
fulldata$relEnergy <- fulldata$meanAffinity-fulldata$wtAffinity
fulldata$varStd <- fulldata$std
fulldata$std <- fulldata$wtstd +fulldata$std
fulldata$perChange <- (fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
fulldata$perSD <- (fulldata$std / abs(fulldata$wtAffinity)) * 100
fulldata <- subset(fulldata, select = -c(rank, rmsd_ub, rmsd_lb, absAffinity, scaffold, trial))
fulldata$perChange <- fulldata$perChange + 100
fulldata <- fulldata[,c(1,2,11)]
cross_valid <- merge(valid, fulldata, by = c("ligand", "variant"))
ggplot(cross_valid, aes(x = perChange, y = value, shape = experiment, color = variant)) +
geom_point(size = 4)
library(reshape2)
library(stringr)
valid <- read.csv("/Users/vikram/Documents/georgetown/summer_2019/opioid_receptor/variantValidationData.csv", header = TRUE)
for (col in colnames(valid)[3:ncol(valid)]){
valid[,col] <- (valid[,col] / valid$ref) * 100
}
for (col in colnames(valid)[3:ncol(valid)]){
colnames(valid)[colnames(valid) == col] <- str_replace(col, "X", "")
}
valid <- valid[,-9]
for (col in colnames(valid)[3:ncol(valid)]){
valid[,col] <- (valid[,col] / valid$wt) * 100
}
valid <- valid[,-3]
valid <- melt(valid, id.vars = c("experiment", "drug"), variable.name = "variant")
colnames(valid)[colnames(valid) == "drug"] <- "ligand"
library(ggplot2)
library(htmlwidgets)
library(highcharter)
library(viridis)
library(webshot)
table <- read.table("/Users/vikram/Documents/georgetown/summer_2019/opioid_receptor/mccoy_snp2sim_data/variantSimulations/OPRM1/results/analysis/153V_234P_235M_235N_238I_302I_wt/vinaSummary_OPRM1.txt", header = TRUE, sep = "")
pdbSet <- unique(table$scaffold)
ligSet <- unique(table$ligand)
varSet <- unique(table$variant)
data <- table
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
wtdata.mean <- aggregate(affinity ~ ligand, wtdata, mean)
wtdata <- aggregate(affinity ~ ligand, wtdata, sd)
wtdata <- merge(wtdata, wtdata.mean, by="ligand")
colnames(wtdata)[colnames(wtdata) == "affinity.x"] <-
"wtstd"
colnames(wtdata)[colnames(wtdata) == "affinity.y"] <-
"wtmeanAffinity"
fulldata <- merge(fulldata, wtdata, by = "ligand")
colnames(fulldata)[colnames(fulldata) == "affinity"] <-
"absAffinity"
colnames(fulldata)[colnames(fulldata) == "wtmeanAffinity"] <-
"wtAffinity"
error <- aggregate(absAffinity ~ ligand + variant, fulldata, sd)
colnames(error)[colnames(error) == "absAffinity"] <- "std"
fulldata <- merge(fulldata, error, by = c("ligand", "variant"))
meanval <- aggregate(absAffinity ~ ligand + variant, fulldata, mean)
colnames(meanval)[colnames(meanval) == "absAffinity"] <- "meanAffinity"
fulldata <- merge(fulldata, meanval,  by = c("ligand", "variant"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "meanAffinity")]),]
fulldata$relEnergy <- fulldata$meanAffinity-fulldata$wtAffinity
fulldata$varStd <- fulldata$std
fulldata$std <- fulldata$wtstd +fulldata$std
fulldata$perChange <- (fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
fulldata$perSD <- (fulldata$std / abs(fulldata$wtAffinity)) * 100
fulldata <- subset(fulldata, select = -c(rank, rmsd_ub, rmsd_lb, absAffinity, scaffold, trial))
fulldata$perChange <- fulldata$perChange + 100
fulldata <- fulldata[,c(1,2,11)]
cross_valid <- merge(valid, fulldata, by = c("ligand", "variant"))
ggplot(cross_valid, aes(x = perChange, y = value, shape = experiment, color = variant)) +
geom_point(size = 4)
minagg <- aggregate(value ~ ligand + variant + perChange, cross_valid, min)
colnames(minagg)[4] <- "minval"
maxagg <- aggregate(value ~ ligand + variant + perChange, cross_valid, max)
colnames(maxagg)[4] <- "maxval"
cross_valid <- merge(cross_valid, minagg, by = c("ligand", "variant", "perChange"))
cross_valid <- merge(cross_valid, maxagg, by = c("ligand", "variant", "perChange"))
crossline <- cross_valid[!duplicated(cross_valid[,c("ligand", "variant", "minval", "maxval")]),]
ggplot(cross_valid, aes(x = perChange, y = value, shape = experiment, color = variant)) +
geom_point(size = 4) +
geom_segment(aes(x = perChange, y = minval, xend = perChange, yend = maxval), crossline)
ggplot(cross_valid, aes(x = perChange, y = value, shape = experiment, color = variant)) +
geom_point(size = 4) +
geom_segment(aes(x = perChange, y = minval, xend = perChange, yend = maxval), crossline) +
ylab("Percent change relative to WT") +
ylab("Percent change in binding energy relative to WT")
ggplot(cross_valid, aes(x = perChange, y = value, shape = experiment, color = variant)) +
geom_point(size = 4) +
facet_wrap(experiment ~ .) +
ylab("Percent change relative to WT") +
ylab("Percent change in binding energy relative to WT")
