color = "black",
size = 1.3
)
args <- c("/Users/vikram/Documents/georgetown/summer_2019/mccoy_snp2sim_data/variantSimulations/OPRM1/results/analysis/153V_234P_235M_235N_238I_302I_wt/vinaSummary_OPRM1.txt")
library(ggplot2)
library(htmlwidgets)
library(highcharter)
library(viridis)
path = paste0(dirname(args[1]), "/figures/")
table <- read.table(args[1], header = TRUE, sep = "")
pdbSet <- unique(table$scaffold)
ligSet <- unique(table$ligand)
varSet <- unique(table$variant)
data <- table
#fulldata <- do.call(rbind, data)
#fulldata <- fulldata[fulldata$rank == 1,]
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
wtdata <- aggregate(affinity ~ ligand, wtdata, min)
fulldata <- merge(fulldata, wtdata, by = "ligand")
fulldata$relEnergy <- fulldata$affinity.x - fulldata$affinity.y
colnames(fulldata)[colnames(fulldata) == "affinity.x"] <-
"absAffinity"
colnames(fulldata)[colnames(fulldata) == "affinity.y"] <-
"wtAffinity"
fulldata$perChange <-
(fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
args<-c(args, "True")
if(args[2] == "True"){
error <- aggregate(absAffinity ~ ligand + variant, fulldata, function(x) sd(x)/sqrt(length(x)))
colnames(error)[colnames(error) == "absAffinity"] <- "std_error"
fulldata <- merge(fulldata, error, by = c("ligand", "variant"))
fulldata$id <- paste(fulldata$ligand, fulldata$variant)
fulldata <- fulldata[order(fulldata[,'id'], fulldata[,'absAffinity']),]
fulldata <- fulldata[!duplicated(fulldata$id),]
}
#fulldata <- do.call(rbind, data)
#fulldata <- fulldata[fulldata$rank == 1,]
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
wtdata <- aggregate(affinity ~ ligand, wtdata, min)
fulldata <- merge(fulldata, wtdata, by = "ligand")
fulldata$relEnergy <- fulldata$affinity.x - fulldata$affinity.y
colnames(fulldata)[colnames(fulldata) == "affinity.x"] <-
"absAffinity"
colnames(fulldata)[colnames(fulldata) == "affinity.y"] <-
"wtAffinity"
fulldata$perChange <-
(fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
error <- aggregate(absAffinity ~ ligand + variant, fulldata, sd)
View(error)
?sd
sd(c(-8, -7.9, -7.6, -8.1, -7.9, -8.3))
colnames(error)[colnames(error) == "absAffinity"] <- "std_dev"
fulldata <- merge(fulldata, error, by = c("ligand", "variant"))
fulldata <- merge(fulldata, aggregate(absAffinity ~ ligand + variant, fulldata, mean))
#fulldata <- do.call(rbind, data)
#fulldata <- fulldata[fulldata$rank == 1,]
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
wtdata <- aggregate(affinity ~ ligand, wtdata, min)
fulldata <- merge(fulldata, wtdata, by = "ligand")
fulldata$relEnergy <- fulldata$affinity.x - fulldata$affinity.y
colnames(fulldata)[colnames(fulldata) == "affinity.x"] <-
"absAffinity"
colnames(fulldata)[colnames(fulldata) == "affinity.y"] <-
"wtAffinity"
fulldata$perChange <-
(fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
if(args[2] == "True"){
error <- aggregate(absAffinity ~ ligand + variant, fulldata, sd)
colnames(error)[colnames(error) == "absAffinity"] <- "std_dev"
fulldata <- merge(fulldata, error, by = c("ligand", "variant"))
fulldata <- merge(fulldata, aggregate(absAffinity ~ ligand + variant, fulldata, mean))
fulldata <- fulldata[order(fulldata[,'id'], fulldata[,'absAffinity']),]
fulldata <- fulldata[!duplicated(fulldata$id),]
}
#fulldata <- do.call(rbind, data)
#fulldata <- fulldata[fulldata$rank == 1,]
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
wtdata <- aggregate(affinity ~ ligand, wtdata, min)
fulldata <- merge(fulldata, wtdata, by = "ligand")
fulldata$relEnergy <- fulldata$affinity.x - fulldata$affinity.y
colnames(fulldata)[colnames(fulldata) == "affinity.x"] <-
"absAffinity"
colnames(fulldata)[colnames(fulldata) == "affinity.y"] <-
"wtAffinity"
fulldata$perChange <-
(fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
if(args[2] == "True"){
error <- aggregate(absAffinity ~ ligand + variant, fulldata, sd)
colnames(error)[colnames(error) == "absAffinity"] <- "std_dev"
fulldata <- merge(fulldata, error, by = c("ligand", "variant"))
fulldata <- merge(fulldata, aggregate(absAffinity ~ ligand + variant, fulldata, mean))
fulldata <- fulldata[order(fulldata[,'id'], fulldata[,'absAffinity']),]
fulldata <- fulldata[!duplicated(fulldata$id),]
}
#fulldata <- do.call(rbind, data)
#fulldata <- fulldata[fulldata$rank == 1,]
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
wtdata <- aggregate(affinity ~ ligand, wtdata, min)
fulldata <- merge(fulldata, wtdata, by = "ligand")
fulldata$relEnergy <- fulldata$affinity.x - fulldata$affinity.y
colnames(fulldata)[colnames(fulldata) == "affinity.x"] <-
"absAffinity"
colnames(fulldata)[colnames(fulldata) == "affinity.y"] <-
"wtAffinity"
fulldata$perChange <-
(fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
error <- aggregate(absAffinity ~ ligand + variant, fulldata, sd)
colnames(error)[colnames(error) == "absAffinity"] <- "std_dev"
fulldata <- merge(fulldata, error, by = c("ligand", "variant"))
mean <- aggregate(absAffinity ~ ligand + variant, fulldata, mean)
View(mean)
fulldata <- merge(fulldata, mean, by = c("ligand", "variant"))
#fulldata <- do.call(rbind, data)
#fulldata <- fulldata[fulldata$rank == 1,]
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
wtdata <- aggregate(affinity ~ ligand, wtdata, min)
fulldata <- merge(fulldata, wtdata, by = "ligand")
fulldata$relEnergy <- fulldata$affinity.x - fulldata$affinity.y
colnames(fulldata)[colnames(fulldata) == "affinity.x"] <-
"absAffinity"
colnames(fulldata)[colnames(fulldata) == "affinity.y"] <-
"wtAffinity"
fulldata$perChange <-
(fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
if(args[2] == "True"){
error <- aggregate(absAffinity ~ ligand + variant, fulldata, sd)
colnames(error)[colnames(error) == "absAffinity"] <- "std_dev"
fulldata <- merge(fulldata, error, by = c("ligand", "variant"))
meanval <- aggregate(absAffinity ~ ligand + variant, fulldata, mean)
colnames(error)[colnames(error) == "absAffinity"] <- "meanAffinity"
fulldata <- merge(fulldata, meanval,  by = c("ligand", "variant"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "meanAffinity")]),]
}
error <- aggregate(absAffinity ~ ligand + variant, fulldata, sd)
colnames(error)[colnames(error) == "absAffinity"] <- "std_dev"
fulldata <- merge(fulldata, error, by = c("ligand", "variant"))
meanval <- aggregate(absAffinity ~ ligand + variant, fulldata, mean)
args <- c("/Users/vikram/Documents/georgetown/summer_2019/run_workflow/snp2simresults/variantSimulations/PDL1/results/analysis/53P_68L_86W_94M_95R_97V_115T_wt/weighted_vinaSummary_PDL1.txt", "False")
library(ggplot2)
library(htmlwidgets)
library(highcharter)
library(viridis)
path = paste0(dirname(args[1]), "/figures/")
table <- read.table(args[1], header = TRUE, sep = "")
pdbSet <- unique(table$scaffold)
ligSet <- unique(table$ligand)
varSet <- unique(table$variant)
data <- table
#fulldata <- do.call(rbind, data)
#fulldata <- fulldata[fulldata$rank == 1,]
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
if(args[2] == "True"){
meanval <- aggregate(absAffinity ~ ligand + variant + scaffold, fulldata, mean)
colnames(meanval)[colnames(meanval) == "absAffinity"] <- "meanAffinity"
fulldata <- merge(fulldata, meanval,  by = c("ligand", "variant"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "scaffold", "meanAffinity")]),]
fulldata$weighted_affinity <- fulldata$meanAffinity * fulldata$weight
error <- aggregate(absAffinity ~ ligand + variant + scaffold, fulldata, var)
colnames(error)[colnames(error) == "absAffinity"] <- "var_scaff"
fulldata <- merge(fulldata, error, by = c("ligand", "variant", "scaffold"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "scaffold", "var_scaff")]),]
fulldata$var_scaff <- fulldata$var_scaff * fulldata$weight^2
std <- aggregate(var_scaff ~ ligand + variant, fulldata, sum)
colnames(std)[colnames(std) == "var_scaff"] <- "std_dev"
std$std_dev <- sqrt(std$std_dev)
fulldata <- merge(fulldata, std, by = c("ligand", "variant"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "std_dev")]),]
} else {
fulldata$weighted_affinity <- fulldata$affinity * fulldata$weight
}
#wtdata <- aggregate(affinity ~ ligand, wtdata, min)
wtdata <- aggregate(weighted_affinity ~ ligand, wtdata, sum)
args <- c("/Users/vikram/Documents/georgetown/summer_2019/mccoy_snp2sim_data/variantSimulations/OPRM1/results/analysis/153V_234P_235M_235N_238I_302I_wt/vinaSummary_OPRM1.txt", "True")
library(ggplot2)
library(htmlwidgets)
library(highcharter)
library(viridis)
path = paste0(dirname(args[1]), "/figures/")
table <- read.table(args[1], header = TRUE, sep = "")
pdbSet <- unique(table$scaffold)
ligSet <- unique(table$ligand)
varSet <- unique(table$variant)
data <- table
#fulldata <- do.call(rbind, data)
#fulldata <- fulldata[fulldata$rank == 1,]
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
wtdata <- aggregate(affinity ~ ligand, wtdata, min)
fulldata <- merge(fulldata, wtdata, by = "ligand")
fulldata$relEnergy <- fulldata$affinity.x - fulldata$affinity.y
colnames(fulldata)[colnames(fulldata) == "affinity.x"] <-
"absAffinity"
colnames(fulldata)[colnames(fulldata) == "affinity.y"] <-
"wtAffinity"
fulldata$perChange <-
(fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
if(args[2] == "True"){
error <- aggregate(absAffinity ~ ligand + variant, fulldata, sd)
colnames(error)[colnames(error) == "absAffinity"] <- "std_dev"
fulldata <- merge(fulldata, error, by = c("ligand", "variant"))
meanval <- aggregate(absAffinity ~ ligand + variant, fulldata, mean)
colnames(meanval)[colnames(meanval) == "absAffinity"] <- "meanAffinity"
fulldata <- merge(fulldata, meanval,  by = c("ligand", "variant"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "meanAffinity")]),]
fulldata$relEnergy <- fulldata$meanAffinity-fulldata$wtAffinity
fulldata$perChange <- (fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
fulldata <- subset(fulldata, select = -c(rank, rmsd_ub, rmsd_lb, absAffinity, scaffold, trial))
}
plotdata <-fulldata
ggplot(fulldata, aes(ligand, relEnergy, fill = ligand, width = .5)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
facet_wrap(. ~ variant) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)
path
#ligand vs relative energy, split by variant
cur <- ggplot(fulldata, aes(ligand, relEnergy, fill = ligand, width = .5)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
facet_wrap(. ~ variant) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)
if(args[2] == "True"){
cur <- cur + geom_errorbar(aes(ymin=relEnergy-std_dev, ymax=relEnergy+std_dev))
}
ggsave(
paste0(path, "lig_relEnergy.jpg", width = 60),
cur
)
ggsave(
paste0(path, "lig_relEnergy.jpg"),
cur, width = 60
)
ggsave(
paste0(path, "lig_relEnergy.jpg"),
cur, width = 20
)
ggsave(
paste0(path, "lig_reEnergy.jpg"),
cur
)
args
path = paste0(dirname(args[1]), "/figures/")
table <- read.table(args[1], header = TRUE, sep = "")
pdbSet <- unique(table$scaffold)
ligSet <- unique(table$ligand)
varSet <- unique(table$variant)
data <- table
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
wtdata <- aggregate(affinity ~ ligand, wtdata, min)
fulldata <- merge(fulldata, wtdata, by = "ligand")
fulldata$relEnergy <- fulldata$affinity.x - fulldata$affinity.y
colnames(fulldata)[colnames(fulldata) == "affinity.x"] <-
"absAffinity"
colnames(fulldata)[colnames(fulldata) == "affinity.y"] <-
"wtAffinity"
fulldata$perChange <-
(fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
if(args[2] == "True"){
error <- aggregate(absAffinity ~ ligand + variant, fulldata, sd)
colnames(error)[colnames(error) == "absAffinity"] <- "std_dev"
fulldata <- merge(fulldata, error, by = c("ligand", "variant"))
meanval <- aggregate(absAffinity ~ ligand + variant, fulldata, mean)
colnames(meanval)[colnames(meanval) == "absAffinity"] <- "meanAffinity"
fulldata <- merge(fulldata, meanval,  by = c("ligand", "variant"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "meanAffinity")]),]
fulldata$relEnergy <- fulldata$meanAffinity-fulldata$wtAffinity
fulldata$perChange <- (fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
fulldata <- subset(fulldata, select = -c(rank, rmsd_ub, rmsd_lb, absAffinity, scaffold, trial))
}
fulltable <- fulldata
part <- fulldata[fulldata$variant %in% input$bargene & fulldata$ligand %in% input$barlig,]
part<-fulldata
ggplot(part, aes_string(input$x, input$y, fill = input$fill)) +
theme_light() +
theme(text=element_text(size=15)) +
geom_bar(stat="identity",position=position_dodge()) +
theme(axis.text.x = element_text(angle = 90))
ggplot(part, aes_string("variant", "relEnergy", fill = "ligand")) +
theme_light() +
theme(text=element_text(size=15)) +
geom_bar(stat="identity",position=position_dodge()) +
theme(axis.text.x = element_text(angle = 90))
g <- ggplot(part, aes_string("variant", "relEnergy", fill = "ligand")) +
theme_light() +
theme(text=element_text(size=15)) +
geom_bar(stat="identity",position=position_dodge()) +
theme(axis.text.x = element_text(angle = 90))
g
g + geom_errorbar(aes(ymin=relEnergy-std_dev, ymax=relEnergy+std_dev))
plotdata <- fulldata
ggplot(plotdata, aes(variant, relEnergy, fill = ligand)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
theme(axis.text.x = element_text(angle = 90))
ggplot(plotdata, aes(variant, relEnergy, fill = ligand)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
theme(axis.text.x = element_text(angle = 90)) + geom_errorbar(aes(ymin=relEnergy-std_dev, ymax=relEnergy+std_dev))
ggplot(plotdata, aes(ligand, relEnergy, fill = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
facet_grid(. ~ variant) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)  +geom_errorbar(aes(ymin=relEnergy-std_dev, ymax=relEnergy+std_dev))
ggplot(plotdata, aes(ligand, relEnergy, fill = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)  +geom_errorbar(aes(ymin=relEnergy-std_dev, ymax=relEnergy+std_dev))
ggplot(plotdata, aes(ligand, relEnergy, fill = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)  +geom_errorbar(aes(ymin=relEnergy-std_dev, ymax=relEnergy+std_dev, fill = variant))
ggplot(plotdata, aes(ligand, relEnergy, fill = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)  +geom_errorbar(aes(ymin=relEnergy-std_dev, ymax=relEnergy+std_dev, position = position_dodge()))
ggplot(plotdata, aes(ligand, relEnergy, fill = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)  +geom_errorbar(aes(ymin=relEnergy-std_dev, ymax=relEnergy+std_dev, fill = variant))
ggplot(plotdata, aes(ligand, relEnergy, fill = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)  +geom_errorbar(aes(ymin=relEnergy-std_dev, ymax=relEnergy+std_dev, position = position_dodge()))
ggplot(plotdata, aes(ligand, relEnergy, fill = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)  +geom_errorbar(aes(ymin=relEnergy-std_dev, ymax=relEnergy+std_dev), position = position_dodge())
#fulldata <- do.call(rbind, data)
#fulldata <- fulldata[fulldata$rank == 1,]
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
wtdata <- aggregate(affinity ~ ligand, wtdata, min)
fulldata <- merge(fulldata, wtdata, by = "ligand")
fulldata$relEnergy <- fulldata$affinity.x - fulldata$affinity.y
colnames(fulldata)[colnames(fulldata) == "affinity.x"] <-
"absAffinity"
colnames(fulldata)[colnames(fulldata) == "affinity.y"] <-
"wtAffinity"
fulldata$perChange <-
(fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
if(args[2] == "True"){
error <- aggregate(absAffinity ~ ligand + variant, fulldata, sd)
colnames(error)[colnames(error) == "absAffinity"] <- "std_dev"
fulldata <- merge(fulldata, error, by = c("ligand", "variant"))
meanval <- aggregate(absAffinity ~ ligand + variant, fulldata, mean)
colnames(meanval)[colnames(meanval) == "absAffinity"] <- "meanAffinity"
fulldata <- merge(fulldata, meanval,  by = c("ligand", "variant"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "meanAffinity")]),]
fulldata$relEnergy <- fulldata$meanAffinity-fulldata$wtAffinity
fulldata$perChange <- (fulldata$relEnergy / abs(fulldata$wtAffinity)) * 100
fulldata$perSD <- sqrt((fulldata$std_dev^2 / abs(fulldata$wtAffinity^2)) * 10000)
fulldata <- subset(fulldata, select = -c(rank, rmsd_ub, rmsd_lb, absAffinity, scaffold, trial))
}
ggplot(fulldata, aes(variant, perChange, fill = variant)) +
theme_light() +
theme(text = element_text(size = 15)) +
geom_bar(stat = "identity", position = position_dodge()) +
labs(y = "Binding Energy Relative to WT (kcal/mol)") +
theme(axis.text.x = element_text(angle = 90)) +
facet_wrap(. ~ ligand) +
geom_hline(
yintercept = 0,
color = "black",
size = 1.3
)  + geom_errorbar(aes(ymin=perChange-perSD, ymax=perChange+perSD))
args <- c("/Users/vikram/Documents/georgetown/summer_2019/run_workflow/snp2simresults/variantSimulations/PDL1/results/analysis/53P_68L_86W_94M_95R_97V_115T_wt/weighted_vinaSummary_PDL1.txt", "False")
library(shiny)
library(ggplot2)
library(highcharter)
library(viridis)
library(plotly)
table <- read.table(args[1], header = TRUE, sep = "")
pdbSet <- unique(table$scaffold)
ligSet <- unique(table$ligand)
varSet <- unique(table$variant)
data <- table
fulldata <- data[data$rank == 1, ]
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
if(args[2] == "True"){
meanval <- aggregate(absAffinity ~ ligand + variant + scaffold, fulldata, mean)
colnames(meanval)[colnames(meanval) == "absAffinity"] <- "meanAffinity"
fulldata <- merge(fulldata, meanval,  by = c("ligand", "variant"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "scaffold", "meanAffinity")]),]
fulldata$weighted_affinity <- fulldata$meanAffinity * fulldata$weight
error <- aggregate(absAffinity ~ ligand + variant + scaffold, fulldata, var)
colnames(error)[colnames(error) == "absAffinity"] <- "var_scaff"
fulldata <- merge(fulldata, error, by = c("ligand", "variant", "scaffold"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "scaffold", "var_scaff")]),]
fulldata$var_scaff <- fulldata$var_scaff * fulldata$weight^2
std <- aggregate(var_scaff ~ ligand + variant, fulldata, sum)
colnames(std)[colnames(std) == "var_scaff"] <- "std_dev"
std$std_dev <- sqrt(std$std_dev)
fulldata <- merge(fulldata, std, by = c("ligand", "variant"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "std_dev")]),]
} else {
fulldata$weighted_affinity <- fulldata$affinity * fulldata$weight
}
#wtdata <- aggregate(affinity ~ ligand, wtdata, min)
wtdata <- aggregate(weighted_affinity ~ ligand, wtdata, sum)
fulldata <- data[data$rank == 1, ]
if(args[2] == "True"){
meanval <- aggregate(absAffinity ~ ligand + variant + scaffold, fulldata, mean)
colnames(meanval)[colnames(meanval) == "absAffinity"] <- "meanAffinity"
fulldata <- merge(fulldata, meanval,  by = c("ligand", "variant"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "scaffold", "meanAffinity")]),]
fulldata$weighted_affinity <- fulldata$meanAffinity * fulldata$weight
error <- aggregate(absAffinity ~ ligand + variant + scaffold, fulldata, var)
colnames(error)[colnames(error) == "absAffinity"] <- "var_scaff"
fulldata <- merge(fulldata, error, by = c("ligand", "variant", "scaffold"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "scaffold", "var_scaff")]),]
fulldata$var_scaff <- fulldata$var_scaff * fulldata$weight^2
std <- aggregate(var_scaff ~ ligand + variant, fulldata, sum)
colnames(std)[colnames(std) == "var_scaff"] <- "std_dev"
std$std_dev <- sqrt(std$std_dev)
fulldata <- merge(fulldata, std, by = c("ligand", "variant"))
fulldata <- fulldata[!duplicated(fulldata[,c("ligand", "variant", "std_dev")]),]
} else {
fulldata$weighted_affinity <- fulldata$affinity * fulldata$weight
}
wtdata <- subset(fulldata, fulldata$variant == "wt")
fulldata <- fulldata[fulldata$variant != "wt",]
#wtdata <- aggregate(affinity ~ ligand, wtdata, min)
wtdata <- aggregate(weighted_affinity ~ ligand, wtdata, sum)
colnames(wtdata)[colnames(wtdata) == "weighted_affinity"] <-
"wtAffinity"
weighted_avgs <- aggregate(weighted_affinity ~ ligand + variant, fulldata, sum)
fulldata <- subset(fulldata, select = -c(rank, rmsd_ub, rmsd_lb, weighted_affinity, scaffold, affinity))
fulldata <- merge(fulldata, wtdata, by = "ligand")
